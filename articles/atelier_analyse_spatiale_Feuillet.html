<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Atelier d'analyse spatiale • notesSIGR2021</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Atelier d'analyse spatiale">
<meta property="og:description" content="notesSIGR2021">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">notesSIGR2021</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GIS_in_R_Nowosad_Lovelace.html">GIS and mapping - A lecture on the GIS and mapping ecosystem of R</a>
    </li>
    <li>
      <a href="../articles/GIS_workshop1_Nowosad_Lovelace.html">GIS workshop</a>
    </li>
    <li>
      <a href="../articles/GIS_workshop2_GIS_Mapping_Nowosad.html">GIS and mapping</a>
    </li>
    <li>
      <a href="../articles/GIS_workshop3_image_processing_Nowosad.html">Image processing and all things raster</a>
    </li>
    <li>
      <a href="../articles/atelier_analyse_image_raster_Madelin.html">Atelier analyse d'images raster</a>
    </li>
    <li>
      <a href="../articles/atelier_analyse_spatiale_Feuillet.html">Atelier d'analyse spatiale</a>
    </li>
    <li>
      <a href="../articles/introduction_git_Timothee_Giraud.html">Introduction à git - Timothée Giraud</a>
    </li>
    <li>
      <a href="../articles/litterate_programming_ronan_ysebaert.html">Litterate programming Ronan Ysebaert</a>
    </li>
    <li>
      <a href="../articles/recherche_reproductible_Arnaud_Legrand.html">Crise de la reproductibilité et science ouverte - Arnaud Legrand</a>
    </li>
    <li>
      <a href="../articles/sciences_reproductibles_analyse_spatiale_Guerois.html">Sciences reproductibles et analyse spatiale
quelques lectures et retours d'expérience</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="atelier_analyse_spatiale_Feuillet_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Atelier d’analyse spatiale</h1>
                        <h4 class="author">Thierry Feuillet</h4>
            
      
      
      <div class="hidden name"><code>atelier_analyse_spatiale_Feuillet.Rmd</code></div>

    </div>

    
    
<p>Support : <a href="https://sigr2021.github.io/gwr/" class="uri">https://sigr2021.github.io/gwr/</a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>
<span class="co">#&gt; Error in library(tidyverse): there is no package called 'tidyverse'</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="co">#&gt; Linking to GEOS 3.9.1, GDAL 3.3.0, PROJ 8.0.1</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmap">tmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">plotly</span><span class="op">)</span>
<span class="co">#&gt; Error in library(plotly): there is no package called 'plotly'</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gtsummary</span><span class="op">)</span>
<span class="co">#&gt; Error in library(gtsummary): there is no package called 'gtsummary'</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">GGally</span><span class="op">)</span>
<span class="co">#&gt; Error in library(GGally): there is no package called 'GGally'</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">GWmodel</span><span class="op">)</span>
<span class="co">#&gt; Error in library(GWmodel): there is no package called 'GWmodel'</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">spdep</span><span class="op">)</span>
<span class="co">#&gt; Error in library(spdep): there is no package called 'spdep'</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">reshape2</span><span class="op">)</span>
<span class="co">#&gt; Error in library(reshape2): there is no package called 'reshape2'</span></code></pre></div>
<p>Méthode permettant d’analyser l’hétérogénéité spatiale</p>
<p>2 lois de géographie - dépendance spatiale : choses liées quand porche : auto-corrélation spatiale - hétérogénéité spatiale: les choses varient dans l’espace (moyenne ou variance, co-variance (les ))</p>
<p>Aujourd’hui étude de la covariance</p>
<p>Non-stationarité spatiale : instabilité dans l’espace des moyennes, variances et covariances.</p>
<p>Lien entre le prix de vente d’un bien immobilier et la surface généralement fort.</p>
<p>Exploration par l’analyse spatiale Méthode GWR : Geographical Weighted Regression : Régression géographiquement pondérée.</p>
<p>Cas d’études: étude du marché immobilier à Oléron.</p>
<p>4 étapes - chargement de la base - modèle de régression classique (moindes carrés) - GWR - extensions possibles - GWR multi-scalaire - classification sur les résidus de la GWR: régionalisation de l’espace</p>
<div id="import-et-préparation-des-données" class="section level1">
<h1 class="hasAnchor">
<a href="#import-et-pr%C3%A9paration-des-donn%C3%A9es" class="anchor"></a>Import et préparation des données</h1>
<p>Base DVF ouverte depuis 2019, réputée fiable</p>
<div id="import-de-la-base" class="section level2">
<h2 class="hasAnchor">
<a href="#import-de-la-base" class="anchor"></a>import de la base</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"https://files.data.gouv.fr/geo-dvf/latest/csv/2020/departements/17.csv.gz"</span><span class="op">)</span>
<span class="co">#&gt; Error in read_csv("https://files.data.gouv.fr/geo-dvf/latest/csv/2020/departements/17.csv.gz"): could not find function "read_csv"</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co">#Pour vérifier que l'import est correct</span>
<span class="co">#&gt;                                                                             </span>
<span class="co">#&gt; 1 function (..., list = character(), package = NULL, lib.loc = NULL,        </span>
<span class="co">#&gt; 2     verbose = getOption("verbose"), envir = .GlobalEnv, overwrite = TRUE) </span>
<span class="co">#&gt; 3 {                                                                         </span>
<span class="co">#&gt; 4     fileExt &lt;- function(x) {                                              </span>
<span class="co">#&gt; 5         db &lt;- grepl("\\\\.[^.]+\\\\.(gz|bz2|xz)$", x)                     </span>
<span class="co">#&gt; 6         ans &lt;- sub(".*\\\\.", "", x)</span></code></pre></div>
</div>
<div id="filtrage" class="section level2">
<h2 class="hasAnchor">
<a href="#filtrage" class="anchor"></a>Filtrage</h2>
<ul>
<li>les communes</li>
<li>les ventes</li>
<li>uniquement les maisons</li>
<li>suppression des valeurs NA</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataOleron</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">nom_commune</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"Dolus-d'Oléron"</span>,
                            <span class="st">"La Brée-les-Bains"</span>,
                            <span class="st">"Le Château-d'Oléron"</span>,
                            <span class="st">"Le Grand-Village-Plage"</span>,
                            <span class="st">"Saint-Denis-d'Oléron"</span>,
                            <span class="st">"Saint-Georges-d'Oléron"</span>,
                            <span class="st">"Saint-Pierre-d'Oléron"</span>,
                            <span class="st">"Saint-Trojan-les-Bains"</span><span class="op">)</span> <span class="op">&amp;</span> 
           <span class="va">nature_mutation</span> <span class="op">==</span> <span class="st">"Vente"</span> <span class="op">&amp;</span> 
           <span class="va">type_local</span> <span class="op">==</span> <span class="st">"Maison"</span> <span class="op">&amp;</span>
           <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">longitude</span><span class="op">)</span> <span class="op">&amp;</span> 
           <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">surface_terrain</span><span class="op">)</span> <span class="op">&amp;</span>
           <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">valeur_fonciere</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in attr(data, "tsp") &lt;- c(start, end, frequency): object is not a matrix</span></code></pre></div>
<div id="conversion-en-dataframe-sf" class="section level3">
<h3 class="hasAnchor">
<a href="#conversion-en-dataframe-sf" class="anchor"></a>Conversion en dataframe {sf}</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataSf</span> <span class="op">&lt;-</span> <span class="va">dataOleron</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>,<span class="st">"latitude"</span><span class="op">)</span>, 
           crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="co"># WGS84</span>
<span class="co">#&gt; Error in st_as_sf(., coords = c("longitude", "latitude"), crs = 4326): object 'dataOleron' not found</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">dataSf</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in st_geometry(dataSf): object 'dataSf' not found</span></code></pre></div>
</div>
<div id="import-du-fond-de-carte-en-shapefile" class="section level3">
<h3 class="hasAnchor">
<a href="#import-du-fond-de-carte-en-shapefile" class="anchor"></a>Import du fond de carte en shapefile</h3>
<p>Données source: <a href="https://github.com/sigr2021/gwr" class="uri">https://github.com/sigr2021/gwr</a></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">oleron</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"../data-raw/oleron.shp"</span><span class="op">)</span>
<span class="co">#&gt; Reading layer `oleron' from data source </span>
<span class="co">#&gt;   `/Users/runner/work/notesSIGR2021/notesSIGR2021/data-raw/oleron.shp' </span>
<span class="co">#&gt;   using driver `ESRI Shapefile'</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span>
<span class="co">#&gt; Geometry type: LINESTRING</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -1.413073 ymin: 45.79904 xmax: -1.187825 ymax: 46.04829</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span>
<span class="co">#&gt; tmap mode set to interactive viewing</span>

<span class="co">## tmap mode set to interactive viewing</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">oleron</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">dataSf</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="co">#&gt; Error in as.list.environment(environment()): object 'dataSf' not found</span></code></pre></div>
</div>
<div id="création-dune-nouvelle-variable-distance-au-littoral" class="section level3">
<h3 class="hasAnchor">
<a href="#cr%C3%A9ation-dune-nouvelle-variable-distance-au-littoral" class="anchor"></a>Création d’une nouvelle variable : distance au littoral</h3>
<p>Hypothèse : prix des maisons varient en fonction de la distance au littoral.</p>
<p>Distance au littoral : variable prédictive</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataSf</span><span class="op">$</span><span class="va">dist_litt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_distance</a></span><span class="op">(</span><span class="va">dataSf</span>, <span class="va">oleron</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/catalyze.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in st_crs(x): object 'dataSf' not found</span></code></pre></div>
</div>
</div>
</div>
<div id="exploration-des-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#exploration-des-variables" class="anchor"></a>Exploration des variables</h1>
<div id="distribution-de-la-variable-dépendante-prix-de-vente" class="section level2">
<h2 class="hasAnchor">
<a href="#distribution-de-la-variable-d%C3%A9pendante-prix-de-vente" class="anchor"></a>Distribution de la variable dépendante (prix de vente)</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_ly</span><span class="op">(</span><span class="va">dataSf</span>, x <span class="op">=</span> <span class="op">~</span><span class="va">valeur_fonciere</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">add_histogram</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in add_histogram(.): could not find function "add_histogram"</span></code></pre></div>
<p>La forme de la distribution permet de choisir le modèle. C’est l’allure de la variable dépendante va aider au calibrage des données.</p>
<p>La distribution tire à droite, il faut utiliser une fonction log pour la rendre normale.</p>
</div>
<div id="suppression-dune-valeur-aberrante" class="section level2">
<h2 class="hasAnchor">
<a href="#suppression-dune-valeur-aberrante" class="anchor"></a>Suppression d’une valeur aberrante</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataSf</span> <span class="op">&lt;-</span> <span class="va">dataSf</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">valeur_fonciere</span> <span class="op">&gt;</span> <span class="fl">1000</span><span class="op">)</span>
<span class="co">#&gt; Error in as.ts(x): object 'dataSf' not found</span></code></pre></div>
</div>
<div id="distribution-très-dissymétrique" class="section level2">
<h2 class="hasAnchor">
<a href="#distribution-tr%C3%A8s-dissym%C3%A9trique" class="anchor"></a>Distribution très dissymétrique</h2>
<p>Transformation avec une fonction <code><a href="https://rdrr.io/pkg/terra/man/math.html">log()</a></code> permet de normaliser la forme de la distribution</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_ly</span><span class="op">(</span><span class="va">dataSf</span>, x <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">valeur_fonciere</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">add_histogram</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in add_histogram(.): could not find function "add_histogram"</span></code></pre></div>
<p>En régression, les valeurs abberrantes peuvent tirer les coefficients.</p>
</div>
<div id="distribution-des-variables-indépendantes" class="section level2">
<h2 class="hasAnchor">
<a href="#distribution-des-variables-ind%C3%A9pendantes" class="anchor"></a>Distribution des variables indépendantes</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">plot_ly</span><span class="op">(</span><span class="va">dataSf</span>, x <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">dist_litt</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">add_histogram</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in add_histogram(.): could not find function "add_histogram"</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">plot_ly</span><span class="op">(</span><span class="va">dataSf</span>, x <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">surface_reelle_bati</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">add_histogram</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in add_histogram(.): could not find function "add_histogram"</span>
<span class="va">c</span> <span class="op">&lt;-</span> <span class="fu">plot_ly</span><span class="op">(</span><span class="va">dataSf</span>, x <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">surface_terrain</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">add_histogram</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in add_histogram(.): could not find function "add_histogram"</span>
<span class="fu">subplot</span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>,<span class="va">c</span><span class="op">)</span>
<span class="co">#&gt; Error in subplot(a, b, c): could not find function "subplot"</span></code></pre></div>
<p>Fonction plot_ly permet d’avoir un graphique interactif.</p>
<p>En régression, les variables explicatives n’ont pas besoin d’être <em>loggées</em> mais c’est plus simple. Les modèles <strong>log-log</strong>, l’interprétation est plus simple (effet d’un pourcentage sur un autre pourcentage)</p>
<p>Poursuite de la préparation des données.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Suppression des maisons vraisemblablement trop petites</span>
<span class="va">dataSf</span> <span class="op">&lt;-</span> <span class="va">dataSf</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">surface_reelle_bati</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; Error in as.ts(x): object 'dataSf' not found</span>

<span class="co"># Création des variables log (pour faciliter la carto par la suite)</span>
<span class="va">dataSf</span><span class="op">$</span><span class="va">log_valeur_fonciere</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">dataSf</span><span class="op">$</span><span class="va">valeur_fonciere</span><span class="op">)</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'dataSf' not found</span>
<span class="va">dataSf</span><span class="op">$</span><span class="va">log_dist_litt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">dataSf</span><span class="op">$</span><span class="va">dist_litt</span><span class="op">)</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'dataSf' not found</span>
<span class="va">dataSf</span><span class="op">$</span><span class="va">log_surface_reelle_bati</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">dataSf</span><span class="op">$</span><span class="va">surface_reelle_bati</span><span class="op">)</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'dataSf' not found</span>
<span class="va">dataSf</span><span class="op">$</span><span class="va">log_surface_terrain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">dataSf</span><span class="op">$</span><span class="va">surface_terrain</span><span class="op">)</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'dataSf' not found</span></code></pre></div>
</div>
<div id="relations-bivariées---formes-fonctionelles" class="section level2">
<h2 class="hasAnchor">
<a href="#relations-bivari%C3%A9es---formes-fonctionelles" class="anchor"></a>Relations bivariées - formes fonctionelles</h2>
<p>On regarde si les relations sont linéaires (pour pouvoir faire une régression linéaire)</p>
<div id="lien-prix---distance-au-littoral" class="section level3">
<h3 class="hasAnchor">
<a href="#lien-prix---distance-au-littoral" class="anchor"></a>Lien prix - distance au littoral</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">ggplot</span><span class="op">(</span><span class="va">dataSf</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">dist_litt</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">valeur_fonciere</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in ggplot(dataSf, aes(x = log(dist_litt), y = log(valeur_fonciere))): could not find function "ggplot"</span></code></pre></div>
<p>Relation assez plate mais pas non linéaire, légèrement négative (plus on s’éloigne du littoral plus prix baisse. Mais pas nécessairement, il y a de l’hétérogéinité spatiale).</p>
</div>
<div id="lien-prix-surface-réelle" class="section level3">
<h3 class="hasAnchor">
<a href="#lien-prix-surface-r%C3%A9elle" class="anchor"></a>Lien prix-surface réelle</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">dataSf</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">surface_reelle_bati</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">valeur_fonciere</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in ggplot(dataSf, aes(x = log(surface_reelle_bati), y = log(valeur_fonciere))): could not find function "ggplot"</span></code></pre></div>
</div>
<div id="lien-prix--surface-terrain" class="section level3">
<h3 class="hasAnchor">
<a href="#lien-prix--surface-terrain" class="anchor"></a>Lien prix- surface terrain</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">dataSf</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">surface_terrain</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">valeur_fonciere</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in ggplot(dataSf, aes(x = log(surface_terrain), y = log(valeur_fonciere))): could not find function "ggplot"</span></code></pre></div>
</div>
</div>
</div>
<div id="modèle-log-log-global-mco" class="section level1">
<h1 class="hasAnchor">
<a href="#mod%C3%A8le-log-log-global-mco" class="anchor"></a>Modèle log-log global (MCO)</h1>
<p>Relation moyenne sur tout l’espace</p>
<ul>
<li>Fonction <code>lm</code> : <em>linear modele</em> régression variable quantitative continue</li>
<li>Fonction <code>glm</code> : variable qualitative, modéle généralisé</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mco</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">log_valeur_fonciere</span> <span class="op">~</span> <span class="va">log_dist_litt</span> <span class="op">+</span> <span class="va">log_surface_reelle_bati</span> <span class="op">+</span> <span class="va">log_surface_terrain</span>, data <span class="op">=</span> <span class="va">dataSf</span><span class="op">)</span>
<span class="co">#&gt; Error in is.data.frame(data): object 'dataSf' not found</span>
<span class="va">mco</span> <span class="op">%&gt;%</span>
  <span class="fu">tbl_regression</span><span class="op">(</span>intercept <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">add_vif</span><span class="op">(</span><span class="op">)</span> <span class="co"># problème (voir package gtsummary ?)</span>
<span class="co">#&gt; Error in add_vif(.): could not find function "add_vif"</span></code></pre></div>
<p><strong>VIF</strong>: <em>Variance Inflation Factor</em></p>
<p>Si 0 n’est pas dans l’intervalle de confiance, cela veut dire que la relation est significative. Si 0 compris dans l’intervalle de confiance, la relation peut être nulle.</p>
<p>Interprétation si distance au littoral augmente de 1%, les prix diminuent de 0,08%.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">mco</span><span class="op">)</span>
<span class="co">#&gt; Error in summary(mco): object 'mco' not found</span></code></pre></div>
<p>Représentation graphique des coefficients</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggcoef_model</span><span class="op">(</span><span class="va">mco</span><span class="op">)</span>
<span class="co">#&gt; Error in ggcoef_model(mco): could not find function "ggcoef_model"</span></code></pre></div>
<p>surface bâti réel et surface terrain ont un effet positif significatif.</p>
</div>
<div id="cartographie-des-résidus" class="section level1">
<h1 class="hasAnchor">
<a href="#cartographie-des-r%C3%A9sidus" class="anchor"></a>Cartographie des résidus</h1>
<p>Résidus: différence entre la valeur y réelle et la valeur y du modèle.</p>
<p>On a souvent des résidus qui forment des pattern spatialisés</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataSf</span><span class="op">$</span><span class="va">resMco</span> <span class="op">&lt;-</span> <span class="va">mco</span><span class="op">$</span><span class="va">residuals</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'mco' not found</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">dataSf</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"resMco"</span>, style <span class="op">=</span> <span class="st">"quantile"</span><span class="op">)</span>
<span class="co">#&gt; Error in as.list.environment(environment()): object 'dataSf' not found</span></code></pre></div>
<p>Couleur rouge : le modèle sous-estime le prix Couleur verte: le modèle sur-estime le prix</p>
</div>
<div id="modèle-gwr" class="section level1">
<h1 class="hasAnchor">
<a href="#mod%C3%A8le-gwr" class="anchor"></a>Modèle GWR</h1>
<div id="principes-généraux" class="section level2">
<h2 class="hasAnchor">
<a href="#principes-g%C3%A9n%C3%A9raux" class="anchor"></a>Principes généraux</h2>
<p>MCO : un coefficient moyen par variable</p>
<p>GWR: coefficient moyen pour chaque maison avec le voisinage uniquement</p>
<p>Choix: distance du voisinage et pondération</p>
<p>Caractérisation du voisinage: Knn, semi-variogramme</p>
<p>GWR: cartographie des variations spatiales: endroits ou tel prédicteur joue et où il ne joue pas.</p>
<p>GWR, étape pour mieux comprendre le territoire et compléter son modèle.</p>
<div id="deux-étapes" class="section level3">
<h3 class="hasAnchor">
<a href="#deux-%C3%A9tapes" class="anchor"></a>Deux étapes</h3>
<p>Définir le voisinage et ensuite le pondérer.</p>
<p>Caractériser le voisinage : distance fix, nbre de voisin, graphe…</p>
<p>Pondération: - binaire (voisin ou non) - pondération selon la distance (fonction inverse)</p>
<p>Il existe 2 packages R pour estimer la GWR.</p>
<p>GWModel est plus convivial mais non compatible avec SF</p>
<p>Première chose à faire : convertir l’objet sf en objet sp</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataSp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html">as_Spatial</a></span><span class="op">(</span><span class="va">dataSf</span><span class="op">)</span> <span class="co"># le package GWmodel n'est pas compatible avec 'sf'</span>
<span class="co">#&gt; Error in as_Spatial(dataSf): object 'dataSf' not found</span></code></pre></div>
<p>Construction de la matrice de distances qui servira pour le calibrage. Donc cela peut devenir un peu long voir compliquer sur de gros échantillons.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">matDist</span> <span class="op">&lt;-</span> <span class="fu">gw.dist</span><span class="op">(</span>dp.locat <span class="op">=</span> <span class="fu">coordinates</span><span class="op">(</span><span class="va">dataSp</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in gw.dist(dp.locat = coordinates(dataSp)): could not find function "gw.dist"</span></code></pre></div>
</div>
</div>
</div>
<div id="optimisation-du-voisinage" class="section level1">
<h1 class="hasAnchor">
<a href="#optimisation-du-voisinage" class="anchor"></a>Optimisation du voisinage</h1>
<p>Paramètres important de GWR:</p>
<ul>
<li>
<code>bw</code>: fenêtre de voisinage</li>
<li>
<code>adaptative</code>: distance (FALSE) ou nbre de voisin (TRUE)</li>
</ul>
<p>Parfois problème de convergence si distance: manque de voisin, donc très grande distance. Nbre de voisin, on est certain d’avoir assez de voisin.</p>
<p>En général, on conseille d’utiliser un nombre de voisin si la répartition n’est pas régulière.</p>
<p>On cherche à minimiser l’AIC entre 2 fonctions pour choisir la meilleure</p>
<p>Fonction bi-carrée: passer un certain seuil la pondération est égale à 0</p>
<div id="comparaison-de-deux-pondérations-spatiales-exponentielle-et-bicarrée" class="section level2">
<h2 class="hasAnchor">
<a href="#comparaison-de-deux-pond%C3%A9rations-spatiales-exponentielle-et-bicarr%C3%A9e" class="anchor"></a>Comparaison de deux pondérations spatiales : exponentielle et bicarrée :</h2>
<div id="calcul-du-nombre-de-voisin-optimal-pour-chaque-pondération-spatiale" class="section level3">
<h3 class="hasAnchor">
<a href="#calcul-du-nombre-de-voisin-optimal-pour-chaque-pond%C3%A9ration-spatiale" class="anchor"></a>Calcul du nombre de voisin optimal pour chaque pondération spatiale</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Exponential</span>
<span class="va">nNeigh.exp</span> <span class="op">&lt;-</span> <span class="fu">bw.gwr</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dataSp</span>, approach <span class="op">=</span> <span class="st">"AICc"</span>, <span class="co"># fonction cible méthode de validation</span>
                     kernel <span class="op">=</span> <span class="st">"exponential"</span>, <span class="co"># fonction de noyau</span>
                     adaptive <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># nbre de voisin</span>
                     dMat <span class="op">=</span> <span class="va">matDist</span>,
                     formula <span class="op">=</span> <span class="va">log_valeur_fonciere</span> <span class="op">~</span> <span class="va">log_dist_litt</span> <span class="op">+</span> <span class="va">log_surface_reelle_bati</span> <span class="op">+</span> <span class="va">log_surface_terrain</span><span class="op">)</span>
<span class="co">#&gt; Error in bw.gwr(data = dataSp, approach = "AICc", kernel = "exponential", : could not find function "bw.gwr"</span></code></pre></div>
<p>Nombre de voisin optimal est égal à 25.</p>
<p>Valeur AICc: paramètre optimal pour le modèle</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Bisquare</span>
<span class="va">nNeigh.bisq</span> <span class="op">&lt;-</span> <span class="fu">bw.gwr</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dataSp</span>, approach <span class="op">=</span> <span class="st">"AICc"</span>, 
                      kernel <span class="op">=</span> <span class="st">"bisquare"</span>, 
                      adaptive <span class="op">=</span> <span class="cn">TRUE</span>, 
                      dMat <span class="op">=</span> <span class="va">matDist</span>, 
                      formula <span class="op">=</span> <span class="va">log_valeur_fonciere</span> <span class="op">~</span> <span class="va">log_dist_litt</span> <span class="op">+</span> <span class="va">log_surface_reelle_bati</span> <span class="op">+</span> <span class="va">log_surface_terrain</span><span class="op">)</span>
<span class="co">#&gt; Error in bw.gwr(data = dataSp, approach = "AICc", kernel = "bisquare", : could not find function "bw.gwr"</span></code></pre></div>
<p>Avec la fonction bisquare, Nombre de voisin optimal est égal à 151.</p>
</div>
<div id="estimation-de-la-gwr" class="section level3">
<h3 class="hasAnchor">
<a href="#estimation-de-la-gwr" class="anchor"></a>Estimation de la GWR</h3>
<div id="avec-pondération-exponential" class="section level4">
<h4 class="hasAnchor">
<a href="#avec-pond%C3%A9ration-exponential" class="anchor"></a>Avec pondération exponential</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">GWR.exp</span> <span class="op">&lt;-</span> <span class="fu">gwr.basic</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dataSp</span>, bw <span class="op">=</span> <span class="va">nNeigh.exp</span>, kernel <span class="op">=</span> <span class="st">"exponential"</span>, adaptive <span class="op">=</span> <span class="cn">TRUE</span>,  dMat <span class="op">=</span> <span class="va">matDist</span>, formula <span class="op">=</span> <span class="va">log_valeur_fonciere</span> <span class="op">~</span> <span class="va">log_dist_litt</span> <span class="op">+</span> <span class="va">log_surface_reelle_bati</span> <span class="op">+</span> <span class="va">log_surface_terrain</span><span class="op">)</span>
<span class="co">#&gt; Error in gwr.basic(data = dataSp, bw = nNeigh.exp, kernel = "exponential", : could not find function "gwr.basic"</span></code></pre></div>
</div>
<div id="avec-pondération-bisquare" class="section level4">
<h4 class="hasAnchor">
<a href="#avec-pond%C3%A9ration-bisquare" class="anchor"></a>Avec pondération bisquare</h4>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">GWR.bisq</span> <span class="op">&lt;-</span> <span class="fu">gwr.basic</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dataSp</span>, bw <span class="op">=</span> <span class="va">nNeigh.bisq</span>, kernel <span class="op">=</span> <span class="st">"bisquare"</span>, 
                      adaptive <span class="op">=</span> <span class="cn">TRUE</span>,  dMat <span class="op">=</span> <span class="va">matDist</span>, 
                      formula <span class="op">=</span> <span class="va">log_valeur_fonciere</span> <span class="op">~</span> <span class="va">log_dist_litt</span> <span class="op">+</span> <span class="va">log_surface_reelle_bati</span> <span class="op">+</span> <span class="va">log_surface_terrain</span><span class="op">)</span>
<span class="co">#&gt; Error in gwr.basic(data = dataSp, bw = nNeigh.bisq, kernel = "bisquare", : could not find function "gwr.basic"</span></code></pre></div>
</div>
</div>
<div id="comparaison-des-deux-calibrations" class="section level3">
<h3 class="hasAnchor">
<a href="#comparaison-des-deux-calibrations" class="anchor"></a>Comparaison des deux calibrations :</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diagGwr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">nNeigh.exp</span>,<span class="va">nNeigh.bisq</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">GWR.exp</span><span class="op">$</span><span class="va">GW.diagnostic</span><span class="op">$</span><span class="va">gw.R2</span>,<span class="va">GWR.bisq</span><span class="op">$</span><span class="va">GW.diagnostic</span><span class="op">$</span><span class="va">gw.R2</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">GWR.exp</span><span class="op">$</span><span class="va">GW.diagnostic</span><span class="op">$</span><span class="va">AIC</span>,<span class="va">GWR.bisq</span><span class="op">$</span><span class="va">GW.diagnostic</span><span class="op">$</span><span class="va">AIC</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">`colnames&lt;-`</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"Nb Voisins"</span>,<span class="st">"R2"</span>,<span class="st">"AIC"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">`rownames&lt;-`</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"EXPONENTIAL"</span>,<span class="st">"BISQUARE"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in rbind(nNeigh.exp, nNeigh.bisq): object 'nNeigh.exp' not found</span>
<span class="va">diagGwr</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'diagGwr' not found</span></code></pre></div>
<p>Explication:</p>
<p>Exponentielle : maximise le R2 (explique 58% de la variation des prix) et minimise l’AIC : modèle plus performant</p>
<p>Bisquare: n’explique que 50% de la variation des prix, l’AIC est moins bon.</p>
<p>A partir de ces éléments, on va choisir la GWR exponentielle (plus performante).</p>
<div id="interprétation-des-résultats-bruts-de-la-gwr" class="section level4">
<h4 class="hasAnchor">
<a href="#interpr%C3%A9tation-des-r%C3%A9sultats-bruts-de-la-gwr" class="anchor"></a>Interprétation des résultats bruts de la GWR :</h4>
<p>Interprétation des résultats de la GWR pas facile mais toujours intéressant.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">GWR.exp</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'GWR.exp' not found</span></code></pre></div>
<p>Min et max distance : min négatif et max positif : inversion de signe par endroit.</p>
<p>Surface réelle: certains endroits la surface a un fort impact, d’autres moins</p>
</div>
<div id="cartographie-des-betas" class="section level4">
<h4 class="hasAnchor">
<a href="#cartographie-des-betas" class="anchor"></a>Cartographie des betas</h4>
<p>pas de fonction toute prête pour cartographier les résidus</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fonction de cartographie automatique des coefficients GWR et de la t-value</span>
<span class="va">mapGWR</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">spdf</span>,<span class="va">var</span>,<span class="va">var_TV</span>,<span class="va">legend.title</span> <span class="op">=</span> <span class="st">"betas GWR"</span>,<span class="va">main.title</span>, <span class="va">dot.size</span> <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tv</span> <span class="op">&lt;-</span> <span class="va">spdf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">var_TV</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">1.96</span>,<span class="op">]</span> <span class="co"># tv t-value: coeff régression / écart-type</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">spdf</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span><span class="va">var</span>, title <span class="op">=</span> <span class="va">legend.title</span>, size <span class="op">=</span> <span class="va">dot.size</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">oleron</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html">tm_lines</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">tv</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">main.title</span>, legend.title.size <span class="op">=</span><span class="fl">0.9</span>, inner.margins <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span> 
<span class="op">}</span></code></pre></div>
<p>t-value: coeff régression / écart-type</p>
<p>Certains endroits coefficients très élevés mais erreur standard aussi, la t-value le met en valeur.</p>
<p>Si t-value très basse : signal un coefficient</p>
</div>
<div id="planche-cartographique-des-3-variables" class="section level4">
<h4 class="hasAnchor">
<a href="#planche-cartographique-des-3-variables" class="anchor"></a>Planche cartographique des 3 variables</h4>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># </span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span>
<span class="co">#&gt; tmap mode set to plotting</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">mapGWR</span><span class="op">(</span><span class="va">GWR.exp</span><span class="op">$</span><span class="va">SDF</span>, var <span class="op">=</span> <span class="st">"log_dist_litt"</span>,var_TV <span class="op">=</span> <span class="va">GWR.exp</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">log_dist_litt_TV</span>,
            main.title <span class="op">=</span> <span class="st">"Distance au littoral"</span><span class="op">)</span>
<span class="co">#&gt; Error in mapGWR(GWR.exp$SDF, var = "log_dist_litt", var_TV = GWR.exp$SDF$log_dist_litt_TV, : object 'GWR.exp' not found</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">mapGWR</span><span class="op">(</span><span class="va">GWR.exp</span><span class="op">$</span><span class="va">SDF</span>, var <span class="op">=</span> <span class="st">"log_surface_reelle_bati"</span>,var_TV <span class="op">=</span> <span class="va">GWR.exp</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">log_surface_reelle_bati_TV</span>,
            main.title <span class="op">=</span> <span class="st">"Surface bâtie"</span><span class="op">)</span>
<span class="co">#&gt; Error in mapGWR(GWR.exp$SDF, var = "log_surface_reelle_bati", var_TV = GWR.exp$SDF$log_surface_reelle_bati_TV, : object 'GWR.exp' not found</span>
<span class="va">c</span> <span class="op">&lt;-</span> <span class="fu">mapGWR</span><span class="op">(</span><span class="va">GWR.exp</span><span class="op">$</span><span class="va">SDF</span>, var <span class="op">=</span> <span class="st">"log_surface_terrain"</span>,var_TV <span class="op">=</span> <span class="va">GWR.exp</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">log_surface_terrain_TV</span>,
            main.title <span class="op">=</span> <span class="st">"Surface terrain"</span><span class="op">)</span>
<span class="co">#&gt; Error in mapGWR(GWR.exp$SDF, var = "log_surface_terrain", var_TV = GWR.exp$SDF$log_surface_terrain_TV, : object 'GWR.exp' not found</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>,<span class="va">c</span><span class="op">)</span>
<span class="co">#&gt; Error in tmap_arrange(a, b, c): object 'a' not found</span></code></pre></div>
<p>Variation de couleur: variation de la variable Si significatif : point au milieu du cercle.</p>
<p>Interprétation des cartes : - Surface bâtie : effet de la surface batie plus importante à chateau d’Oléron et à Saint Pierre d’Oléron (valeurs rouge) qu’ailleurs. Pour une étude très locale, cela ne vaudra pas le coup d’étudier cette variable - Surface terrain: Saint Denis - Distance au littoral: Saint Trojan, les prix vont beaucoup augmenter quand on se rapproche du littoral (effet pont ?)</p>
<p>Effets de contexte locaux - caractéristqiues intrinsèques / endogènes : normes locales partagées ex quartier pavillionnaire - caractéristiques exogènes : effet pont à proximité</p>
</div>
</div>
</div>
</div>
<div id="aller-plus-loin" class="section level1">
<h1 class="hasAnchor">
<a href="#aller-plus-loin" class="anchor"></a>Aller plus loin</h1>
<div id="gwr-multiscalaire" class="section level2">
<h2 class="hasAnchor">
<a href="#gwr-multiscalaire" class="anchor"></a>GWR multiscalaire</h2>
<p>Modèle mixte : GWR + modèle global dans le même modèle.</p>
<p>Nombre de variable déterminé pour chaque variable.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"../R/gwr.multiscale_T.r"</span><span class="op">)</span> 

<span class="co"># On lance la MGWR</span>
<span class="va">MGWR</span> <span class="op">&lt;-</span> <span class="fu">gwr.multiscale</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">log_valeur_fonciere</span> <span class="op">~</span> <span class="va">log_dist_litt</span> <span class="op">+</span> 
                         <span class="va">log_surface_reelle_bati</span> <span class="op">+</span> <span class="va">log_surface_terrain</span>,
                       data <span class="op">=</span> <span class="va">dataSp</span>, kernel <span class="op">=</span> <span class="st">"exponential"</span>,
                       predictor.centered<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="cn">T</span>, <span class="fl">3</span><span class="op">)</span>, <span class="co"># centrage des prédicteurs</span>
                       adaptive <span class="op">=</span> <span class="cn">TRUE</span>,
                       bws0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="co"># BW minimum pour l'optimisation</span>
<span class="co">#&gt; Error in is(data, "Spatial"): object 'dataSp' not found</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mgwr.bw</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">MGWR</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">bws</span>,<span class="fl">1</span><span class="op">)</span> <span class="co"># Nombre de voisins pour chaque prédicteur</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'MGWR' not found</span>
<span class="va">mgwr.bw</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'mgwr.bw' not found</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Exploration des résultats statistiques</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">MGWR</span><span class="op">)</span>
<span class="co">#&gt; Error in print(MGWR): object 'MGWR' not found</span></code></pre></div>
<p>On constate que si l’effet de la surface bâtie sur les prix agit de façon assez globale à l’échelle de l’île, les deux autres prédicteurs agissent de manière beaucoup plus locales. Ainsi par exemple, l’effet de la distance au littoral relève d’un processus très localisé.</p>
<div id="cartographie-des-résultats" class="section level3">
<h3 class="hasAnchor">
<a href="#cartographie-des-r%C3%A9sultats" class="anchor"></a>Cartographie des résultats</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">mapGWR</span><span class="op">(</span><span class="va">MGWR</span><span class="op">$</span><span class="va">SDF</span>, var <span class="op">=</span> <span class="st">"log_dist_litt"</span>,var_TV <span class="op">=</span> <span class="va">MGWR</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">log_dist_litt_TV</span>,
       main.title <span class="op">=</span> <span class="st">"Distance au littoral (bw = 77)"</span><span class="op">)</span>
<span class="co">#&gt; Error in mapGWR(MGWR$SDF, var = "log_dist_litt", var_TV = MGWR$SDF$log_dist_litt_TV, : object 'MGWR' not found</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">mapGWR</span><span class="op">(</span><span class="va">MGWR</span><span class="op">$</span><span class="va">SDF</span>, var <span class="op">=</span> <span class="st">"log_surface_reelle_bati"</span>,var_TV <span class="op">=</span> <span class="va">MGWR</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">log_surface_reelle_bati_TV</span>,
       main.title <span class="op">=</span> <span class="st">"Surface bâtie (bw = 368)"</span><span class="op">)</span>
<span class="co">#&gt; Error in mapGWR(MGWR$SDF, var = "log_surface_reelle_bati", var_TV = MGWR$SDF$log_surface_reelle_bati_TV, : object 'MGWR' not found</span>
<span class="va">c</span> <span class="op">&lt;-</span> <span class="fu">mapGWR</span><span class="op">(</span><span class="va">MGWR</span><span class="op">$</span><span class="va">SDF</span>, var <span class="op">=</span> <span class="st">"log_surface_terrain"</span>,var_TV <span class="op">=</span> <span class="va">MGWR</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">log_surface_terrain_TV</span>,
       main.title <span class="op">=</span> <span class="st">"Surface terrain (bw = 23)"</span><span class="op">)</span>
<span class="co">#&gt; Error in mapGWR(MGWR$SDF, var = "log_surface_terrain", var_TV = MGWR$SDF$log_surface_terrain_TV, : object 'MGWR' not found</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>,<span class="va">c</span><span class="op">)</span>
<span class="co">#&gt; Error in tmap_arrange(a, b, c): object 'a' not found</span></code></pre></div>
</div>
</div>
<div id="régionalisation-des-sous-marchés-immobiliers" class="section level2">
<h2 class="hasAnchor">
<a href="#r%C3%A9gionalisation-des-sous-march%C3%A9s-immobiliers" class="anchor"></a>Régionalisation des sous-marchés immobiliers</h2>
<p>On peut utiliser des coefficients locaux pour identifier des zones homogènes où on va essayer que les prédicteurs soient homogènes.</p>
<p>Sous-régions où les effets sont à peu près homogènes: minimisation de la variance.</p>
<p>Principe général: regrouper les observations qui se ressemblent (classification) mais aussi il faut qu’elles soient proches.</p>
<p>Plusieurs méthodes existent, nous allons utiliser SKATER qui utilise des graphes.</p>
<p>Méthode SKATER implémentée dans {spdep}.</p>
<p>Méthode en 4 étapes: - graphe de voisinage - pondération des arrètes (fonction de dissimilarité : GWR) - élagage de l’arbre - maximiser la variance inter-classe des graphes.</p>
<div id="première-étape-préparation-de-la-table-des-coefficients-gwr" class="section level3">
<h3 class="hasAnchor">
<a href="#premi%C3%A8re-%C3%A9tape-pr%C3%A9paration-de-la-table-des-coefficients-gwr" class="anchor"></a>Première étape : préparation de la table des coefficients GWR</h3>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Centrage-réduction pour rendre les coefficients comparables</span>
<span class="va">gwrB.scaled</span> <span class="op">&lt;-</span> <span class="va">GWR.exp</span><span class="op">$</span><span class="va">SDF</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/scale.html">scale</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"b"</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in rename_with(., ~paste(.x, "b", sep = "_")): could not find function "rename_with"</span></code></pre></div>
</div>
<div id="deuxième-étape-computation-de-lalgorithme-skater" class="section level3">
<h3 class="hasAnchor">
<a href="#deuxi%C3%A8me-%C3%A9tape-computation-de-lalgorithme-skater" class="anchor"></a>Deuxième étape : computation de l’algorithme SKATER</h3>
<div id="définition-du-voisinage-de-chaque-bien" class="section level4">
<h4 class="hasAnchor">
<a href="#d%C3%A9finition-du-voisinage-de-chaque-bien" class="anchor"></a>Définition du voisinage de chaque bien</h4>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">knn</span> <span class="op">&lt;-</span> <span class="fu">knearneigh</span><span class="op">(</span><span class="va">GWR.exp</span><span class="op">$</span><span class="va">SDF</span>, k<span class="op">=</span><span class="fl">50</span><span class="op">)</span> <span class="co"># 50 pour que le graphe soit fermé</span>
<span class="co">#&gt; Error in knearneigh(GWR.exp$SDF, k = 50): could not find function "knearneigh"</span>
<span class="va">nb</span> <span class="op">&lt;-</span> <span class="fu">knn2nb</span><span class="op">(</span><span class="va">knn</span><span class="op">)</span> <span class="co"># nombre de voisin</span>
<span class="co">#&gt; Error in knn2nb(knn): could not find function "knn2nb"</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">nb</span>, coords <span class="op">=</span> <span class="fu">coordinates</span><span class="op">(</span><span class="va">GWR.exp</span><span class="op">$</span><span class="va">SDF</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
<span class="co">#&gt; Error in plot(nb, coords = coordinates(GWR.exp$SDF), col = "blue"): object 'nb' not found</span></code></pre></div>
<p>Si graphe non fermé partout (connexité ?), il y a une erreur, augmentation du paramètre <code>k</code>.</p>
</div>
<div id="calibrage-du-coût-des-arêtes-et-de-la-pondération-spatiale" class="section level4">
<h4 class="hasAnchor">
<a href="#calibrage-du-co%C3%BBt-des-ar%C3%AAtes-et-de-la-pond%C3%A9ration-spatiale" class="anchor"></a>Calibrage du coût des arêtes et de la pondération spatiale</h4>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">costs</span> <span class="op">&lt;-</span> <span class="fu">nbcosts</span><span class="op">(</span><span class="va">nb</span>, data <span class="op">=</span> <span class="va">gwrB.scaled</span><span class="op">)</span> <span class="co"># pondération des arêtes</span>
<span class="co">#&gt; Error in nbcosts(nb, data = gwrB.scaled): could not find function "nbcosts"</span>
<span class="va">costsW</span> <span class="op">&lt;-</span> <span class="fu">nb2listw</span><span class="op">(</span><span class="va">nb</span>, <span class="va">costs</span>, style<span class="op">=</span><span class="st">"B"</span><span class="op">)</span> <span class="co"># transformation en matrice de pondération, style : type de pondération, "B" binary</span>
<span class="co">#&gt; Error in nb2listw(nb, costs, style = "B"): could not find function "nb2listw"</span></code></pre></div>
</div>
<div id="minimisation-de-larbre-et-classification" class="section level4">
<h4 class="hasAnchor">
<a href="#minimisation-de-larbre-et-classification" class="anchor"></a>Minimisation de l’arbre et classification</h4>
<p>Suppression des arêtes qui ont des poids faibles (points qui se ressemblent pas). Au final, 1 point à une arête.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">costsTree</span> <span class="op">&lt;-</span> <span class="fu">mstree</span><span class="op">(</span><span class="va">costsW</span><span class="op">)</span>
<span class="co">#&gt; Error in mstree(costsW): could not find function "mstree"</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">costsTree</span>, coords <span class="op">=</span> <span class="fu">coordinates</span><span class="op">(</span><span class="va">GWR.exp</span><span class="op">$</span><span class="va">SDF</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"blue"</span>, main <span class="op">=</span> <span class="st">"Arbre portant minimal"</span><span class="op">)</span>
<span class="co">#&gt; Error in plot(costsTree, coords = coordinates(GWR.exp$SDF), col = "blue", : object 'costsTree' not found</span></code></pre></div>
<p>Découpe en 6 groupes</p>
<p><code>ncuts</code>: nombre de groupe - 1</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clus6</span> <span class="op">&lt;-</span> <span class="fu">skater</span><span class="op">(</span>edges <span class="op">=</span> <span class="va">costsTree</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, data <span class="op">=</span> <span class="va">gwrB.scaled</span>, ncuts <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; Error in skater(edges = costsTree[, 1:2], data = gwrB.scaled, ncuts = 5): could not find function "skater"</span></code></pre></div>
</div>
</div>
<div id="troisième-étape-analyse-des-résultats" class="section level3">
<h3 class="hasAnchor">
<a href="#troisi%C3%A8me-%C3%A9tape-analyse-des-r%C3%A9sultats" class="anchor"></a>Troisième étape : analyse des résultats</h3>
<div id="cartographie-des-clusters" class="section level4">
<h4 class="hasAnchor">
<a href="#cartographie-des-clusters" class="anchor"></a>Cartographie des clusters</h4>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataClus</span> <span class="op">&lt;-</span> <span class="va">dataSf</span> <span class="op">%&gt;%</span> 
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>clus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">clus6</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">gwrB.scaled</span><span class="op">)</span>
<span class="co">#&gt; Error in bind_cols(., gwrB.scaled): could not find function "bind_cols"</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"view"</span><span class="op">)</span>
<span class="co">#&gt; tmap mode set to interactive viewing</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">dataClus</span><span class="op">)</span> <span class="op">+</span> 
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_symbols</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"clus"</span>, size<span class="op">=</span><span class="fl">.8</span>, palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Classification en 6 groupes"</span><span class="op">)</span> 
<span class="co">#&gt; Error in as.list.environment(environment()): object 'dataClus' not found</span></code></pre></div>
</div>
<div id="caractérisation-des-clusters" class="section level4">
<h4 class="hasAnchor">
<a href="#caract%C3%A9risation-des-clusters" class="anchor"></a>Caractérisation des clusters</h4>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nomVar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"log_dist_litt_b"</span>,<span class="st">"log_surface_reelle_bati_b"</span>,<span class="st">"log_surface_terrain_b"</span>,<span class="st">"Intercept_b"</span><span class="op">)</span>

<span class="va">clusProfile</span> <span class="op">&lt;-</span> <span class="va">dataClus</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">nomVar</span>, <span class="st">"clus"</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">clus</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_each.html">summarise_each</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># moyenne des coeff GWR pour chaque cluster</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in summarise_each(., funs(mean)): could not find function "summarise_each"</span>

<span class="va">clusLong</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu">melt</span><span class="op">(</span><span class="va">clusProfile</span>, id.vars <span class="op">=</span> <span class="st">"clus"</span><span class="op">)</span>
<span class="co">#&gt; Error in loadNamespace(x): there is no package called 'reshape2'</span>

<span class="va">profilePlot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">clusLong</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, 
           fill <span class="op">=</span> <span class="st">"grey25"</span>, 
           position <span class="op">=</span> <span class="st">"identity"</span>, 
           stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_discrete</span><span class="op">(</span><span class="st">"Effet"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="st">"Valeur moyenne par classe"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">clus</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill<span class="op">=</span><span class="st">"grey25"</span><span class="op">)</span>,
        strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey85"</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in ggplot(clusLong): could not find function "ggplot"</span>

<span class="va">profilePlot</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'profilePlot' not found</span></code></pre></div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicolas Roelandt.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
