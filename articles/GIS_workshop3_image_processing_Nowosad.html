<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image processing and all things raster • notesSIGR2021</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Image processing and all things raster">
<meta property="og:description" content="notesSIGR2021">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">notesSIGR2021</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GIS_in_R_Nowosad_Lovelace.html">GIS and mapping - A lecture on the GIS and mapping ecosystem of R</a>
    </li>
    <li>
      <a href="../articles/GIS_workshop1_Nowosad_Lovelace.html">GIS workshop</a>
    </li>
    <li>
      <a href="../articles/GIS_workshop2_GIS_Mapping_Nowosad.html">GIS and mapping</a>
    </li>
    <li>
      <a href="../articles/GIS_workshop3_image_processing_Nowosad.html">Image processing and all things raster</a>
    </li>
    <li>
      <a href="../articles/atelier_analyse_image_raster_Madelin.html">Atelier analyse d'images raster</a>
    </li>
    <li>
      <a href="../articles/atelier_analyse_spatiale_Feuillet.html">Atelier d'analyse spatiale</a>
    </li>
    <li>
      <a href="../articles/introduction_git_Timothee_Giraud.html">Introduction à git - Timothée Giraud</a>
    </li>
    <li>
      <a href="../articles/litterate_programming_ronan_ysebaert.html">Litterate programming Ronan Ysebaert</a>
    </li>
    <li>
      <a href="../articles/recherche_reproductible_Arnaud_Legrand.html">Crise de la reproductibilité et science ouverte - Arnaud Legrand</a>
    </li>
    <li>
      <a href="../articles/sciences_reproductibles_analyse_spatiale_Guerois.html">Sciences reproductibles et analyse spatiale
quelques lectures et retours d'expérience</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="GIS_workshop3_image_processing_Nowosad_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Image processing and all things raster</h1>
                        <h4 class="author">Jakub Nowosad</h4>
            
      
      
      <div class="hidden name"><code>GIS_workshop3_image_processing_Nowosad.Rmd</code></div>

    </div>

    
    
<p>Slides : <a href="https://nowosad.github.io/SIGR2021/workshop2/workshop2.html#1" class="uri">https://nowosad.github.io/SIGR2021/workshop2/workshop2.html#1</a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">srtm_path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"raster/srtm.tif"</span>, package <span class="op">=</span> <span class="st">"spDataLarge"</span><span class="op">)</span>
<span class="va">srtm_path</span>
<span class="co">#&gt; [1] "/Users/runner/work/_temp/Library/spDataLarge/raster/srtm.tif"</span></code></pre></div>
<p><code>system.file</code> : nice way to get access to example data contained in packages by getting the path.</p>
<p>R packages are better for storing files than R objects. FIles are mor generic and broader.</p>
<p>Load {terra} and the dataset</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra">terra</a></span><span class="op">)</span>
<span class="co">#&gt; terra version 1.3.4</span>
<span class="va">srtm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="va">srtm_path</span><span class="op">)</span>
<span class="va">srtm</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 457, 465, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 0.0008333333, 0.0008333333  (x, y)</span>
<span class="co">#&gt; extent      : -113.2396, -112.8521, 37.13208, 37.51292  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">#&gt; source      : srtm.tif </span>
<span class="co">#&gt; name        : srtm </span>
<span class="co">#&gt; min value   : 1024 </span>
<span class="co">#&gt; max value   : 2892</span></code></pre></div>
<p><code><a href="https://rdrr.io/pkg/terra/man/rast.html">rast()</a></code> just connect to the file but not loading into memory. It also provide useful information about the dataset.</p>
<p>Looks to alternatives of {terra}: - {raster} : predecessor of {terra}, no new developpement - {stars} : compatible with {sf}, quick, multidimensional, support different types of raster (regular (90% of use cases), rotated, sheared, rectilinear, curvilinear), connect to geospatial servers (works in progress)</p>
<div id="maps" class="section level1">
<h1 class="hasAnchor">
<a href="#maps" class="anchor"></a>Maps</h1>
<div id="mapping-tools" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-tools" class="anchor"></a>Mapping tools</h2>
<p>Maps were detailed earlier, this workshop will use <code><a href="https://rdrr.io/pkg/terra/man/plot.html">plot()</a></code> and <code><a href="https://rdrr.io/pkg/tmap/man/tmap-package.html">tmap()</a></code></p>
<p>Generally, <code><a href="https://rdrr.io/pkg/terra/man/plot.html">plot()</a></code> functions simplifies datasets larger than the image dimensions. It is faster to do that.</p>
<p>With <code><a href="https://rdrr.io/pkg/tmap/man/tmap-package.html">tmap()</a></code> if there is more than 1 million cells, the data will bo down sampled by <code><a href="https://rdrr.io/pkg/tmap/man/tmap-package.html">tmap()</a></code></p>
</div>
</div>
<div id="map-algebra" class="section level1">
<h1 class="hasAnchor">
<a href="#map-algebra" class="anchor"></a>Map algebra</h1>
<p>Four groups - <strong>local</strong> : computation one cell - <strong>focal</strong> : cell value and its neigbourg (<em>moving window</em>) - <strong>zonal operations</strong> summarize raster values for somes zones - <strong>global</strong> summarize the whole raster (max, min …)</p>
<div id="local-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#local-operations" class="anchor"></a>Local operations</h2>
<ul>
<li>raster calculator</li>
<li><code>srtm2 = srtm * 1000</code></li>
<li>
<code>srtm3 = srtm - globale(srtm, min)[[1]]</code> =&gt; 0 -&gt; to max value</li>
<li>
<code>srtm3 = srtm - globale(srtm, median)[[1]]</code> =&gt; 0 will be the median value, negative value are under the median value</li>
<li>replacing values</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">srtm_new</span> <span class="op">=</span> <span class="va">srtm</span>
<span class="va">srtm_new</span><span class="op">[</span><span class="va">srtm_new</span> <span class="op">&lt;</span> <span class="fl">1500</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="co"># values under 1500 will be NA</span></code></pre></div>
<ul>
<li>reclassification
<ul>
<li>Reclassification table (2 or 3 columns) : from this value to this value replace by this value</li>
<li>
<code>classify</code> takes reclassification table as argument</li>
</ul>
</li>
<li>operations on many layers (calculating spectral indices, NDVI and such)
<ul>
<li>landsat dataset is a simplified dataset from landsat</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">landsat_path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"raster/landsat.tif"</span>, package <span class="op">=</span> <span class="st">"spDataLarge"</span><span class="op">)</span>
<span class="va">landsat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="va">landsat_path</span><span class="op">)</span>
<span class="va">landsat</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 1428, 1128, 4  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 30, 30  (x, y)</span>
<span class="co">#&gt; extent      : 301905, 335745, 4111245, 4154085  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs </span>
<span class="co">#&gt; source      : landsat.tif </span>
<span class="co">#&gt; names       : lan_1, lan_2, lan_3, lan_4 </span>
<span class="co">#&gt; min values  :  7550,  6404,  5678,  5252 </span>
<span class="co">#&gt; max values  : 19071, 22051, 25780, 31961</span></code></pre></div>
<ul>
<li>Write a function to compute the ndvi.</li>
<li>use the <code><a href="https://rdrr.io/pkg/terra/man/lapp.html">lapp()</a></code> function</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ndvi_fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">nir</span>, <span class="va">red</span><span class="op">)</span><span class="op">{</span>
  <span class="op">(</span><span class="va">nir</span> <span class="op">-</span> <span class="va">red</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">nir</span> <span class="op">+</span> <span class="va">red</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">ndvi</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/lapp.html">lapp</a></span><span class="op">(</span><span class="va">landsat</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, <span class="co"># subset 2 layers (4 and 3) from the dataset</span>
            fun <span class="op">=</span> <span class="va">ndvi_fun</span><span class="op">)</span> <span class="co"># custom ndvi function</span></code></pre></div>
</div>
<div id="focal-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#focal-operations" class="anchor"></a>Focal operations</h2>
<p>Works on cell neigbourhoood, we need to provide the neighbourghood (<em>window</em>)</p>
<p>The window is provided by a matrix (mandatory type). The function will be applied on the center cell. The matrix can be weighted to have special effect. The matrix needs to be uneven 3x3, 5x5, 7x7. With 4x4 matrix, the function will not be able to determined the center.</p>
<p><strong>Sobel operator</strong> : edge detector</p>
<p>The operation starts from the top left to the bottom right, but the order does not change the output.</p>
<p>You can use focal operation on categorical raster : “what’s the most dominant value.”</p>
</div>
<div id="zonal-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#zonal-operations" class="anchor"></a>Zonal operations</h2>
<p>also know as zonal statistics. Results are <strong>summary table</strong> not a raster.</p>
<p>You can provide a function, some are optimised : “mean”, “max”, “min”, “media” <strong>note the <code>"</code></strong>.</p>
</div>
<div id="global-operation" class="section level2">
<h2 class="hasAnchor">
<a href="#global-operation" class="anchor"></a>Global operation</h2>
<p>Got a result for the whole raster. <code><a href="https://rdrr.io/pkg/terra/man/global.html">global()</a></code></p>
</div>
<div id="exercices" class="section level2">
<h2 class="hasAnchor">
<a href="#exercices" class="anchor"></a>Exercices</h2>
<ul>
<li>Find the file path of the nz_elev.tif data using the following code: system.file(“raster/nz_elev.tif”, package = “spDataLarge”). Read this file into R. What is the resolution of the data?</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"raster/nz_elev.tif"</span>, package <span class="op">=</span> <span class="st">"spDataLarge"</span><span class="op">)</span>
<span class="co">#&gt; [1] "/Users/runner/work/_temp/Library/spDataLarge/raster/nz_elev.tif"</span>

<span class="va">nz_elev</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"raster/nz_elev.tif"</span>, package <span class="op">=</span> <span class="st">"spDataLarge"</span><span class="op">)</span><span class="op">)</span>
<span class="va">nz_elev</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 1450, 1115, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span>
<span class="co">#&gt; extent      : 995456.5, 2110457, 4741961, 6191961  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=tmerc +lat_0=0 +lon_0=173 +k=0.9996 +x_0=1600000 +y_0=10000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : nz_elev.tif </span>
<span class="co">#&gt; name        : elevation </span>
<span class="co">#&gt; min value   :         0 </span>
<span class="co">#&gt; max value   :  4140.333</span></code></pre></div>
<p>The resolution is <code>resolution  : 1000, 1000  (x, y)</code></p>
<ul>
<li>Create and customize a map based on the nz_elev.tif dataset. Save the result to a .png file.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmap">tmap</a></span><span class="op">)</span>

<span class="va">nz_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">nz_elev</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">#tm_graticules() +</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>style <span class="op">=</span> <span class="st">"cont"</span>, 
            title <span class="op">=</span> <span class="st">"elevation (m a.s.l)"</span>,
            palette <span class="op">=</span> <span class="st">"-Spectral"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,
               text.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_credits.html">tm_credits</a></span><span class="op">(</span><span class="st">"Nicolas Roelandt, 2021"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>inner.margins <span class="op">=</span> <span class="fl">0</span>,
    main.title <span class="op">=</span> <span class="st">"New Zealand"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_save.html">tmap_save</a></span><span class="op">(</span><span class="va">nz_map</span>, <span class="st">"vignettes/images/new_zealand_elevation.png"</span><span class="op">)</span>
<span class="co">#&gt; Warning in showSRID(SRS_string, format = "PROJ", multiline = "NO", prefer_proj</span>
<span class="co">#&gt; = prefer_proj): Discarded datum Unknown_based_on_GRS80_ellipsoid in Proj4</span>
<span class="co">#&gt; definition</span>
<span class="co">#&gt; stars object downsampled to 877 by 1140 cells. See tm_shape manual (argument raster.downsample)</span>
<span class="co">#&gt; Warning in showSRID(SRS_string, format = "PROJ", multiline = "NO", prefer_proj</span>
<span class="co">#&gt; = prefer_proj): Discarded datum Unknown_based_on_GRS80_ellipsoid in Proj4</span>
<span class="co">#&gt; definition</span>
<span class="co">#&gt; stars object downsampled to 877 by 1140 cells. See tm_shape manual (argument raster.downsample)</span>
<span class="co">#&gt; Map saved to vignettes/images/new_zealand_elevation.png</span>
<span class="co">#&gt; Resolution: 1841.903 by 2394.263 pixels</span>
<span class="co">#&gt; Size: 6.139675 by 7.980878 inches (300 dpi)</span>
<span class="co">#&gt; Error in dev.off(): QuartzBitmap_Output - unable to open file 'vignettes/images/new_zealand_elevation.png'</span></code></pre></div>
<ul>
<li>Replace values below 0 to 1 (depressions), values between 0 and 300 to 2 (plains), values between 300 and 600 to 3 (hills), and values between 600 and the maximum value to 4 (mountains) in the nz_elev object. Create a new object nz_elev_class.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rcl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">0</span>, <span class="fl">1</span>, 
               <span class="fl">0</span>, <span class="fl">300</span>, <span class="fl">2</span>, 
               <span class="fl">300</span>, <span class="fl">600</span>, <span class="fl">3</span>, 
               <span class="fl">600</span>, <span class="fl">4140.333</span>, <span class="fl">4</span><span class="op">)</span>,
             ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">rcl</span>
<span class="co">#&gt;      [,1]     [,2] [,3]</span>
<span class="co">#&gt; [1,] -Inf    0.000    1</span>
<span class="co">#&gt; [2,]    0  300.000    2</span>
<span class="co">#&gt; [3,]  300  600.000    3</span>
<span class="co">#&gt; [4,]  600 4140.333    4</span>
<span class="va">nz_elev_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/classify.html">classify</a></span><span class="op">(</span><span class="va">nz_elev</span>, rcl <span class="op">=</span> <span class="va">rcl</span><span class="op">)</span>
<span class="va">nz_elev_class</span> 
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 1450, 1115, 1  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span>
<span class="co">#&gt; extent      : 995456.5, 2110457, 4741961, 6191961  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=tmerc +lat_0=0 +lon_0=173 +k=0.9996 +x_0=1600000 +y_0=10000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; name        : elevation </span>
<span class="co">#&gt; min value   :         2 </span>
<span class="co">#&gt; max value   :         4</span></code></pre></div>
<ul>
<li><p>Look at the focal function documentation. Apply the Laplacian and the Sobel filters on nz_elev. Compare the results visually.</p></li>
<li><p>Calculate an average elevation value in nz_elev for each category in nz_elev_class.</p></li>
<li><p>Write a function to calculate the soil-adjusted vegetation index (SAVI; <a href="https://en.wikipedia.org/wiki/Soil-adjusted_vegetation_index" class="uri">https://en.wikipedia.org/wiki/Soil-adjusted_vegetation_index</a> ). Calculate SAVI for the Landsat 8 images for the area of Zion National Park.</p></li>
</ul>
</div>
</div>
<div id="transformations" class="section level1">
<h1 class="hasAnchor">
<a href="#transformations" class="anchor"></a>Transformations</h1>
<div id="resampling" class="section level2">
<h2 class="hasAnchor">
<a href="#resampling" class="anchor"></a>Resampling</h2>
</div>
<div id="reprojecting-rasters" class="section level2">
<h2 class="hasAnchor">
<a href="#reprojecting-rasters" class="anchor"></a>Reprojecting rasters</h2>
<ul>
<li>different from vector</li>
<li>needs to resample
<ul>
<li>create an empty raster template</li>
<li>to fillthe empty value, use <code><a href="https://rdrr.io/pkg/terra/man/resample.html">resample()</a></code>
</li>
<li>parameters : base image, empty raster, function to explain how to resample (method : “bilinear” - good for continues values, “nearest neighbourg” - only one for categorical data)</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wgs84</span> <span class="op">=</span> <span class="st">"EPSG:4326"</span>

<span class="va">nlcd_wgs84</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html">project</a></span><span class="op">(</span><span class="va">nlcd</span>, <span class="va">wgs84</span>, method <span class="op">=</span> <span class="st">"near"</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'project': object 'nlcd' not found</span></code></pre></div>
<p>To create your own projection : <a href="https://projectionwizard.org/">projectionwizard.org</a></p>
</div>
</div>
<div id="raster-vector-interactions" class="section level1">
<h1 class="hasAnchor">
<a href="#raster-vector-interactions" class="anchor"></a>Raster-vector interactions</h1>
<div id="raster-cropping-and-masking" class="section level2">
<h2 class="hasAnchor">
<a href="#raster-cropping-and-masking" class="anchor"></a>Raster cropping and masking</h2>
<p>Cropping : remove data outside the BBox Crop is fast</p>
<p>The mask function replace all values outside the shape with NA. Mask is always used with a cropped image to delete NA data outside the shape</p>
</div>
<div id="raster-extraction" class="section level2">
<h2 class="hasAnchor">
<a href="#raster-extraction" class="anchor"></a>Raster extraction</h2>
<div id="with-points" class="section level3">
<h3 class="hasAnchor">
<a href="#with-points" class="anchor"></a>With points</h3>
<ul>
<li>gps points or anything.</li>
</ul>
<p>For example, I want elevation of each point using the elevation raster.</p>
<p><code><a href="https://rdrr.io/pkg/terra/man/extract.html">terra::extract()</a></code></p>
<p>The extract is a dataframe with ID and value.</p>
</div>
<div id="with-polygons" class="section level3">
<h3 class="hasAnchor">
<a href="#with-polygons" class="anchor"></a>With polygons</h3>
<p>A polygons covers a lotof pixels. Extract each pixel values and give the ID of the polygons.</p>
<p>Useful to see the distribution, do some some statistics.</p>
</div>
</div>
<div id="rasterization" class="section level2">
<h2 class="hasAnchor">
<a href="#rasterization" class="anchor"></a>Rasterization</h2>
<p>Transform vector data to raster data</p>
<div id="presence-absence" class="section level3">
<h3 class="hasAnchor">
<a href="#presence-absence" class="anchor"></a>Presence / Absence</h3>
<ul>
<li><p><code>rasterize</code> if there is a point in the cell, I get a value of one (TRUE/FALSE)</p></li>
<li><p><code>fun = length</code> : count of point in the cell</p></li>
<li><p><code>field = "vals", fun = sum</code> : sum “vals” values of all points inside the cell</p></li>
</ul>
</div>
</div>
<div id="vectorization" class="section level2">
<h2 class="hasAnchor">
<a href="#vectorization" class="anchor"></a>Vectorization</h2>
<p>From raster to vector.</p>
<p>Often to create polygons on a categorical raster data</p>
<ul>
<li>create borders</li>
<li>contours lines (elevation lines, precipitations lines, isolines) : <code><a href="https://rdrr.io/pkg/terra/man/contour.html">as.contour()</a></code> : you can provide a number of line to create (<code>nlines</code>) or elevation limits <code>z</code> ,</li>
</ul>
</div>
</div>
<div id="conversions" class="section level1">
<h1 class="hasAnchor">
<a href="#conversions" class="anchor"></a>Conversions</h1>
<p>From spatial type/class to another</p>
</div>
<div id="output" class="section level1">
<h1 class="hasAnchor">
<a href="#output" class="anchor"></a>Output</h1>
<p>Save raster file</p>
<p><code><a href="https://rdrr.io/pkg/terra/man/writeRaster.html">writeRaster()</a></code> : depending on the file extension we can have different format With {terra}, geoTIFF are compressed by default.</p>
</div>
<div id="raster-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#raster-analysis" class="anchor"></a>Raster analysis</h1>
<div id="global-or-local-autocorrelation" class="section level2">
<h2 class="hasAnchor">
<a href="#global-or-local-autocorrelation" class="anchor"></a>Global or local autocorrelation</h2>
<p><code><a href="https://rdrr.io/pkg/terra/man/autocor.html">autocor()</a></code> : - by default, global autocorrelation - default is ‘Moran’ but you can use ‘Geary’ autocorrelation For elevation, high autocorrelation is expected</p>
<p>For local correlation - provide a window - matrix neighborhood - can be <code>queen</code> (8-n) or <code>rook</code> (4-n) neighborhood - <code>global = FALSE</code> - the output is a raster: find place with high or low autocorrelation</p>
</div>
<div id="predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#predictions" class="anchor"></a>Predictions</h2>
<p>{terra} objects can be used on glm, randomForest or prcomp functions.</p>
</div>
<div id="interpolations" class="section level2">
<h2 class="hasAnchor">
<a href="#interpolations" class="anchor"></a>Interpolations</h2>
<p><code><a href="https://rdrr.io/pkg/terra/man/interpolate.html">interpolate()</a></code></p>
<p>We have points but we want areas.</p>
<p>Create a model from the points (splines, kriging, IDW)</p>
<p>Geostatistiques with {gstat}</p>
<p><code>gstat::variogram()</code> distance between values and how values are dissimilear to each other.</p>
</div>
<div id="segmentations" class="section level2">
<h2 class="hasAnchor">
<a href="#segmentations" class="anchor"></a>Segmentations</h2>
<p>{supercells} : super-pixels : automatically find similar areas in visible imagerie</p>
<p>Return an {sf} dataframe with centroids coordinates and mean pixel value of each band of supercell.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicolas Roelandt.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
